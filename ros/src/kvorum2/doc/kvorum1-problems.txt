22.03.2024
Проблемы Кворума (1), выявленные в ходе моделирования группового следования
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


1. Абсолютные пути, зависящие от системы, на которой запускается моделирование
2. Плохие относительные пути (могут не туда указывать, очень длинные с многократными выходами из директории, не пользуются поиском пакетов catkin для упрощения и т.п.)
3. pylib нужно оформить как пакет catkin, чтобы избежать подключения как системной библиотеки
-- ИСПРАВЛЕНО. Оформлено как пакет kvorum

4. Нельзя создавать агентов в среде вручную. `_RobotNum_` генерируется автоматически и не может различать между типами агентов, а агенты, созданные в управляющем скрипте 
   вручную не будут созданы в модельном скрипте.
-- РЕШЕНИЕ ОТЛОЖЕНО. Такова текущая архитектура: все должно быть известно заранее. kvorum_m должен изначально понимать, с какими объектами ему работать. Порождать их динамически он в текущей версии не умеет.

5. Использование вложенных вызовов (одной функции внутри другой) ломается в `agents.ctl` из-за `exec()`
-- РЕШЕНИЕ ОТЛОЖЕНО. 

6.  Сбор всех наблюдаемых параметров объекта (light value, IR value, etc.) в один виртуальный объект необходимо делать вручную специальными алгоритмами
-- ЗАМЕЧАНИЕ ОТКЛОНЕНО. Задача системы - предоставить информацию к сенсорным данным, а дальше - сугубо пользовательское дело.

7. Долгая загрузка при инициализации симуляции (инициализация агентов для визуализации)
8. Задержки визуализации: ~0.5 с при старте и такая же при завершении, а также похоже, что пропускается много шагов обновлений без отрисовки
-- РЕШЕНИЕ 7,8 ОТЛОЖЕНО. 1) Там очень медленная графика. kvorum_v надо будет когда-нибудь переписать. 2) Рисование делается так: kvorum_m отсылает модулю рисования kvorum_v сообщения о том, 
     что надо кого-то где-то нарисовать.

9. Библиотека симуляции использует топики ROS (которые не гарантируют доставки) для таких методов как `tmu.SetAgentPos()`, что означает, что они не выполняются, когда между
   инициализацией симуляции и вызывом соответствующих методов (например, инициализация поз агентов) не вставлена (или не происходит естественным образом) достаточная задержка, 
   такая как `sleep`
-- РЕШЕНИЕ ОТЛОЖЕНО.

10. Сложная и хрупкая загрузка управляющего API симуляции (использующая вызовы exec()) делает сложным или невозможным его интеграцию в другие высокоуровневые фреймворки 
    (такие как конечные автоматы FlexBE, создающие отдельные процессы) в качестве клиента
-- РЕШЕНИЕ ОТЛОЖЕНО.

11. Агент с `id=0` специальный и не может быть использован при создании агентов, поскольку обработка его сенсоров не выполняется, при этом не сообщая об ошибке
-- ИСПРАВЛЕНО. id=0 зарезервирован, при использовании id<=0 выдается сообщение об ошибке.

12. Частота обновления сенсора истинного положения зависит от количества типов других полей, которые выбраны в методе`self.robot.RequestAllSensors` (True/False)
13. Частота обновления сенсора истинного положения слишком медленная (~1.6 Hz когда выбраны все поля, 10 Hz с исключительно MainSensors), возможно зависит от какой-то 
    ещё настройки частоты в коде
-- РЕШЕНИЕ 12, 13 ОТЛОЖЕНО. Когда агентов много, получается слишком большой поток сообщений, система "захлебывается". Потому, например, запросы к датчикам предпочтительно делать по очереди, через такт.
   Особенно это актуально, когда идет работа с реальным железом.
-- ПРИМЕЧАНИЕ. В Kvorum2 это работает быстрее

14. Необходима поддержка столкновений объектов различной формы (хотя бы простых квадратов и кругов вокруг агента с различными размерами)
15. Переключатель, отключающий столкновения был бы полезен (возможность поместить много агентов в одну клетку)
-- ЗАМЕЧАНИЯ 14, 15 ОТКЛОНЕНЫ. В системе нет понятия формы. Есть лишь занятая/свободная клетки.

16. `robot.SetVSpeed` и `robot.agent.MainSensors[-3:-1]` (истинное положение) используют различные единицы измерения, скорость похоже в м/с, а поза в клетках с неясным разрешением.
    Или возможно это что-то, связанное с симуляционным временем, поскольку с угловой скоростью та же проблема
-- ЗАМЕЧАНИЕ ОТКЛОНЕНО. Все единицы измерения - модельные: [расст./такт], [град./такт]]. расст. - модельное расстояние, град. - кол-во градусов.

17. Кворум использует во многих местах градусы, в то время как стандартом во многих библиотеках (включая ROS) являются радианы
-- ЗАМЕЧАНИЕ ОТКЛОНЕНО. Кворум везде использует градусы. 1) так нагляднее, 2) так экономится ресурс при передаче данных (целое вместо действительного числа). Изначально Кворум создавался для управления
   реальными роботами архитектуры TMU.

18. Похоже, что Кворум использует какое-то другое понятие времени, отличающееся от системного времени. Связь между системным и симуляционным временем неясна.
-- ЗАМЕЧАНИЕ ОТКЛОНЕНО. Там действительно совсем абстрактное время

19. Неоднородное и нестандартное наименование (переменные могут начинаться с маленькой или заглавной буквы в одном и том же скрипте)
-- РЕШЕНИЕ ОТЛОЖЕНО. 

20. Перезапуск скрипта модели дублирует агентов в визуализации, если модель визуализации не была тоже перезапущена
-- ОТКЛОНЕНО. Дублирование при имеющейся архитектуре неизбежно.

21. Кворум не предоставляет сенсоров, которые выдают позу наблюдаемого объекта
-- ОТКЛОНЕНО. Неясно, о каких сенсорах может идти речь, непонятно, что такое "поза"?

22. Кворум не предоставляет сенсоров, которые одновременно выдают значение и позицию (или дистанцию), хотя камера на обычном роботе такое может 
    (кроме суперлокаторов, в каком-то смысле)
23. Суперлокатор может служить для обхода сенсорной проблемы выше, но он может быть только один, поскольку есть лишь один список для значений суперлокатора, что 
    делает невозможным наблюдать суперлокаторами за несколькими сенсорными слоями сразу
-- ЗАМЕЧАНИЯ 22, 23 ОТКЛОНЕНЫ. Действительно, в некторых задачах суперлокатор используется как эмулятор камеры. Суперлокатор - и так выколотая точка, т.к. крайне медленно работает и занимает много ресурсов. 
   Кроме того, непонятно, о каких еще подобного типа датчиках может идти речь. Сенсоры на наших роботах примитивные.

24. У Кворума нет примеров использования локаторов (должны возвращать gdic.RST_VECTOR)
-- ИСПРАВЛЕНО. Пример добавлен в examples/03-sensors

25. Документация не всегда верная: локаторы нумеруют углы против часовой стрелки, в то время как в документации они нарисованы по часовой стрелке (fig 3.6).
-- ИСПРАВЛЕНО. Добавлено примечание. fig 3.6 был о другом

26. Абстракция Кворума слишком низкоуровневая, требуются надёжные простые сенсоры (например, выдающие координаты всех ближайших объектов в радиусе) вместо полуреалистичных,
    основанных на лучах. Они требуют обработки слишком много тяжелого кода, специфичного для сенсоров, что не подходит для мультиагентных симуляций.
-- ЗАМЕЧАНИЕ ОТКЛОНЕНО. KVORUM - это геометрическое, поведенческое моделирование с приближением к железу. Компромисс между абстрактными и физическими системами.
