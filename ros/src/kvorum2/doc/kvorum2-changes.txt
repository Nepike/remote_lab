Изменения в Kvorum2 по сравнению с Kvorum(1)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
30.08.2024


Глобально:

I. Kvorum2 перестал базироваться на архитектуре TMU и соответствующем протоколе RCx.
Это позволило:
1) Упростить архитектуру ядра системы.
2) Сделать структуры сообщений более прозрачными, что облегчает создание различного рода переходников.
3) Снять ограничения на номенклатуру датчиков.

II. Изменился программный интерфейс
Исходя из опыта использования, частично упростился интерфейс, ряд стандартных блоков стал поддерживаться библиотечно (tmurobot), изменилось описание сенсоров.


1. Во всех файлах kvorum заменяется на kvorum2
В том числе - в файлах .m, .v: надо заменить kvorum на kvorum2

2. Изменения в топиках:

    A) Единый пакет топиков. Все лежит здесь:
    /src/kvorum2/msg/msg

    B) Изменились структур топиков (ans, sensors...)

3. Удаление модулей

    A) Убран модуь tmubase. Остался один tmurobot (все переехало туда).
    B) Убран модуль rcproto. Все коды команд переехали в gdic.

4. Описание сенсоров (в конфигурации)
   A) Сенсоры имеют имена
   B) Сенсоры хранятся в едином словаре SENSORS. Никаких указаний "контроллеров" и индексов.
   C) Добавление сенсоров -- функция A.AddSens()
   D) Номенклатура сенсоров не ограничена. Суперлокаторов может быть много.

5. Чтение сенсорных данных
    A) Запрос сенсоров:
        Вместо  r.RequestAllSensors(immediate=True, ...)
        вызывается
        r.RequestSensors(sensorlist)
        sensorlist -- Запрос значений сенсоров с именами из заданного списка. Если sensorlist== None, то запрашиваются все сенсоры.

    B) Получение значения сенсора:
        r.GetSensor(sensorname)
        Можно и так:
          r.agent.SENSORS[sensorname]
        SENSORS - это словарь
    C) Вывод значений сенсоров. Можно указывать конкретные имена.
       ShowStatus(sensors_list)


6. Регистры теперь не поддерживаются
    Вместо них - внутренние сенсоры
        SENSORS['position'] - позиция робота в модельной среде
        SENSORS['encoder_left'], SENSORS['encoder_right'] - энкодеры

    Новый метод
        def Position(self): return int(self.GetX()), int(self.GetY()), int(self.GetAng())
    Возвращает x, y, a
      def GetX(self): return self.pos[0]
      def GetY(self): return self.pos[1]
      def GetAng(self): return self.pos[2] % 360


7. Изменения в интерфейсе tmu
    A) В TRobot добавлены поля для работы с автоматом
    B) Подписывание на нужные топики
        tmu.InitUsersTopics(len(Agents))
    вместо rospy.Subscriber(...)..., rospy.Publisher(...)
    C) Имена топиков лежат в модуле gdic

    D) Создание роботов
        r = tmu.TRobotBase(a)
    старый вариант: r = tmu.TRobotBase(a, pub_cmd)

8. Неподдерживаемые команды
    CMD_GET_ALL_REG
    CMD_GET_REG
    CMD_GET_ALL_REG
    CMD_GET_USR_DATA
    CMD_GET_I2C_DATA
    CMD_F_GET_SUPER_LOCATOR
    CMD_GET_I2C_DATA
    
