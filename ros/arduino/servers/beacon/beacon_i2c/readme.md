
Дата обновления документации: 2020.02.10

beacon_i2c - прошивка для маяка.

EMITTER определяет в каком режиме работает устройство:
  - если определён флаг - режим передатчика
  - если не определён флаг - режим приёмника

Управление системой управление маяка по шине i2c. Подробности ниже 

После включения контроллера, для него необходимо задать режим работы. Для этого отправляется пакет с одной из команд установки режима - CMD_SET_IRA_MODE или CMD_SET_RC5_MODE.
Начиная с версии прошивки v1.1, длина приёма/передачи пакета всегда I2C_BUF_LEN = 5 байт 

========== ПОДКЛЮЧЕНИЕ	==========

    TSOP    	| # pin
--------------------------
  PIN_TSOP_1	|	8
  PIN_TSOP_2	|	9
  PIN_TSOP_3	|	10
  PIN_TSOP_4  |	11

  излуч	| # pin
----------------
  EMIT	|	  3

==========  КОМАНДЫ по i2c 	==========

	Param		          | Value |			description
---------------------------------------------------------------
 CMD_EMIT_STOP	    | 	0	  | остановить передачу
 CMD_EMIT_START_RC5	| 	1	  | начать передачу RC5 сигнала(сигнал на основе параметров из массива exec)
 CMD_EMIT_START_IRA | 	2   | начать передачу IRA сигнала(сигнал на основе параметров из массива exec)
 			
==========  РЕЖИМЫ  ==========

	  Mode		        | Value  |			description
---------------------------------------------------------------
 CMD_SET_IRA_MODE   |	  3    | установить контроллер в режим IRA / работа в режиме IRA 
 CMD_SET_RC5_MODE   | 	4    | установить контроллер в режим RC5 / работа в режиме RC5 
 NOT_START	        |  0xFF  | значение, передаваемое маяком, если не установлен режим 
 
==========   Протокол передачи по i2c	==========

Длина: 5 байт

На приём (receiveEvent):
exec[0]		- команда (что делать с данными) 
exec[1]		-	количество передаваемых байт 
exec[2]		-	отправляемый сигнал (данные)
exec[3]		-	частота отправки (сколько раз в секунду излучатель отправляет сигнал)
exec[4]		- доп.байт (не используется в текущей версии) 	

На отправку (requestEvent): 

bufferMsg[0]  -   данные с TSOP0
bufferMsg[1]  -   данные с TSOP1
bufferMsg[2]  -   данные с TSOP2
bufferMsg[3]  -   данные с TSOP3
bufferMsg[4]  -   режим работы маяка

Пример:
символ '-' - любое значение 
Остановить передачу:
 0 | - | - | - | - 

 Начать излучать сигнал 0xE1 с частотой 2 Гц
  1 | 3 | 0xE1 | 2 | - 

Полученный пакет с данными.  Для маяка не установлен режим, данных нет:
 0 | 0 | 0 | 0 | 0xFF

Полученный пакет с данными. Маяк работает в режиме RC5, распознаёт два сигнала со значением 4 и один со значением 2:
 4 | 4 | 2 | 0 | 4

==========	НАСТРОЙКА	==========

  Flag	| 			description
------------------------------------------
DEBUG	
    вкл/выкл отладочный вывод в порт


	Param		| 			description
---------------------------------------------------------------

BAUD_RATE		    
    скорость передачи по серийному порту

TSOP_KEEP_IN_MEMORY_TIME
    время в мс, в течение которого хранится информация об обнаруженных сигналах 

ADDR_RCV
    адрес приёмника
    
ADDR_EMIT
    адрес передатчика
    
I2C_BUF_LEN
    количество получаемых по i2c байт
    
RC5numdigits
    количество передаваемых разрядов	 
    
REPETITION_DELAY
    задержка между пакетами RC5 (114 ms is standard for RC-5)
    
